{
  "openapi": "3.0.3",
  "info": {
    "title": "Bounty Challenge API",
    "description": "API for the GitHub Issue Bounty Challenge - Rewards miners for valid bug reports",
    "version": "0.1.0",
    "contact": {
      "name": "PlatformNetwork",
      "url": "https://github.com/PlatformNetwork/bounty-challenge"
    }
  },
  "servers": [
    {
      "url": "http://localhost:8080",
      "description": "Local development server"
    },
    {
      "url": "https://chain.platform.network/api/v1/bridge/bounty-challenge",
      "description": "Production bridge (via Platform Network)"
    }
  ],
  "paths": {
    "/health": {
      "get": {
        "summary": "Health check",
        "description": "Returns server health status and basic info",
        "tags": ["System"],
        "responses": {
          "200": {
            "description": "Server is healthy",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HealthResponse" },
                "example": {
                  "healthy": true,
                  "load": 0.0,
                  "pending": 0,
                  "uptime_secs": 3600,
                  "version": "0.1.0",
                  "challenge_id": "bounty-challenge"
                }
              }
            }
          }
        }
      }
    },
    "/config": {
      "get": {
        "summary": "Get challenge configuration",
        "description": "Returns the current challenge configuration",
        "tags": ["System"],
        "responses": {
          "200": {
            "description": "Challenge configuration",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ConfigResponse" }
              }
            }
          }
        }
      }
    },
    "/get_weights": {
      "get": {
        "summary": "Get miner weights",
        "description": "Returns current weights for all registered miners (platform-compatible)",
        "tags": ["Weights"],
        "parameters": [
          {
            "name": "epoch",
            "in": "query",
            "description": "Optional epoch number (defaults to current)",
            "schema": { "type": "integer" }
          }
        ],
        "responses": {
          "200": {
            "description": "Miner weights",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/GetWeightsResponse" },
                "example": {
                  "weights": [
                    { "hotkey": "5FHneW46...", "weight": 0.25 },
                    { "hotkey": "5GrwvaEF...", "weight": 0.15 }
                  ],
                  "epoch": 12345678,
                  "challenge_id": "bounty-challenge",
                  "total_miners": 2
                }
              }
            }
          }
        }
      }
    },
    "/leaderboard": {
      "get": {
        "summary": "Get leaderboard",
        "description": "Returns top miners by weight",
        "tags": ["Weights"],
        "responses": {
          "200": {
            "description": "Leaderboard data",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/LeaderboardResponse" },
                "example": {
                  "leaderboard": [
                    {
                      "github_username": "echobt",
                      "hotkey": "5FHneW46...",
                      "issues_resolved_24h": 5,
                      "weight": 0.25
                    }
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/register": {
      "post": {
        "summary": "Register GitHub account",
        "description": "Link a GitHub username to a miner hotkey with cryptographic signature",
        "tags": ["Registration"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/RegisterRequest" },
              "example": {
                "hotkey": "5FHneW46xGXgs5mUiveU4sbTyGBzmstUspZC92UhjJM694ty",
                "github_username": "echobt",
                "signature": "0x1234abcd...",
                "timestamp": 1705622400
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Registration result",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/RegisterResponse" },
                "examples": {
                  "success": {
                    "value": {
                      "success": true,
                      "message": "Successfully registered @echobt with your hotkey.",
                      "error": null
                    }
                  },
                  "error": {
                    "value": {
                      "success": false,
                      "message": null,
                      "error": "Invalid signature. Make sure you're using the correct key."
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/status/{hotkey}": {
      "get": {
        "summary": "Get miner status",
        "description": "Returns registration status and stats for a hotkey",
        "tags": ["Registration"],
        "parameters": [
          {
            "name": "hotkey",
            "in": "path",
            "required": true,
            "description": "Miner hotkey (SS58 format)",
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": {
            "description": "Miner status",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/StatusResponse" },
                "examples": {
                  "registered": {
                    "value": {
                      "registered": true,
                      "github_username": "echobt",
                      "valid_issues_count": 5,
                      "invalid_issues_count": 1,
                      "balance": 4,
                      "is_penalized": false,
                      "weight": 0.05
                    }
                  },
                  "not_registered": {
                    "value": {
                      "registered": false,
                      "github_username": null,
                      "valid_issues_count": null,
                      "invalid_issues_count": null,
                      "balance": null,
                      "is_penalized": false,
                      "weight": null
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/stats": {
      "get": {
        "summary": "Get challenge statistics",
        "description": "Returns overall challenge statistics",
        "tags": ["Stats"],
        "responses": {
          "200": {
            "description": "Challenge stats",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/StatsResponse" },
                "example": {
                  "total_bounties": 150,
                  "total_miners": 25,
                  "total_invalid": 10,
                  "penalized_miners": 2,
                  "challenge_id": "bounty-challenge",
                  "version": "0.1.0"
                }
              }
            }
          }
        }
      }
    },
    "/invalid": {
      "post": {
        "summary": "Record invalid issue",
        "description": "Record an issue as invalid (for penalty tracking)",
        "tags": ["Issues"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/InvalidIssueRequest" },
              "example": {
                "issue_id": 123,
                "repo_owner": "PlatformNetwork",
                "repo_name": "bounty-challenge",
                "github_username": "spammer",
                "issue_url": "https://github.com/PlatformNetwork/bounty-challenge/issues/123",
                "issue_title": "Spam issue",
                "reason": "Low quality / spam"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Result",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/InvalidIssueResponse" }
              }
            }
          }
        }
      }
    },
    "/issues": {
      "get": {
        "summary": "List all issues",
        "description": "Get cached GitHub issues with optional filters",
        "tags": ["Issues"],
        "parameters": [
          {
            "name": "state",
            "in": "query",
            "description": "Filter by state (open/closed)",
            "schema": { "type": "string", "enum": ["open", "closed"] }
          },
          {
            "name": "label",
            "in": "query",
            "description": "Filter by label (e.g., valid, invalid, bug)",
            "schema": { "type": "string" }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "Max results (default 50, max 200)",
            "schema": { "type": "integer", "default": 50 }
          },
          {
            "name": "offset",
            "in": "query",
            "description": "Pagination offset",
            "schema": { "type": "integer", "default": 0 }
          }
        ],
        "responses": {
          "200": {
            "description": "List of issues",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/IssuesListResponse" },
                "example": {
                  "issues": [
                    {
                      "issue_id": 1,
                      "repo_owner": "PlatformNetwork",
                      "repo_name": "bounty-challenge",
                      "github_username": "echobt",
                      "title": "[BUG] Test issue",
                      "state": "open",
                      "labels": ["bug", "valid"],
                      "created_at": "2026-01-19T00:47:00Z",
                      "updated_at": "2026-01-19T00:47:00Z",
                      "closed_at": null,
                      "issue_url": "https://github.com/PlatformNetwork/bounty-challenge/issues/1"
                    }
                  ],
                  "count": 1,
                  "limit": 50,
                  "offset": 0
                }
              }
            }
          }
        }
      }
    },
    "/issues/pending": {
      "get": {
        "summary": "List pending issues",
        "description": "Get closed issues without valid/invalid label (need review)",
        "tags": ["Issues"],
        "parameters": [
          {
            "name": "limit",
            "in": "query",
            "schema": { "type": "integer", "default": 50 }
          },
          {
            "name": "offset",
            "in": "query",
            "schema": { "type": "integer", "default": 0 }
          }
        ],
        "responses": {
          "200": {
            "description": "List of pending issues",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/IssuesListResponse" }
              }
            }
          }
        }
      }
    },
    "/issues/stats": {
      "get": {
        "summary": "Get issues statistics",
        "description": "Get counts by status (total, open, closed, valid, invalid, pending)",
        "tags": ["Issues"],
        "responses": {
          "200": {
            "description": "Issues statistics",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/IssuesStatsResponse" },
                "example": {
                  "total": 100,
                  "open": 25,
                  "closed": 75,
                  "valid": 60,
                  "invalid": 10,
                  "pending": 5
                }
              }
            }
          }
        }
      }
    },
    "/hotkey/{hotkey}": {
      "get": {
        "summary": "Get hotkey details",
        "description": "Get detailed info for a miner hotkey including recent issues",
        "tags": ["Details"],
        "parameters": [
          {
            "name": "hotkey",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": {
            "description": "Hotkey details",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HotkeyDetailsResponse" },
                "example": {
                  "hotkey": "5FHneW46...",
                  "github_username": "echobt",
                  "registered_at": "2026-01-15T10:00:00Z",
                  "valid_issues": 5,
                  "invalid_issues": 1,
                  "balance": 4,
                  "is_penalized": false,
                  "weight": 0.05,
                  "recent_issues": [
                    {
                      "issue_id": 1,
                      "repo_owner": "PlatformNetwork",
                      "repo_name": "bounty-challenge",
                      "title": "[BUG] Test",
                      "state": "open",
                      "labels": ["bug", "valid"],
                      "updated_at": "2026-01-19T00:47:00Z",
                      "issue_url": "https://github.com/..."
                    }
                  ]
                }
              }
            }
          },
          "404": {
            "description": "Hotkey not found",
            "content": {
              "application/json": {
                "example": { "error": "Hotkey not found" }
              }
            }
          }
        }
      }
    },
    "/github/{username}": {
      "get": {
        "summary": "Get GitHub user details",
        "description": "Get info for a GitHub user including registration and issues",
        "tags": ["Details"],
        "parameters": [
          {
            "name": "username",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": {
            "description": "GitHub user details",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/GitHubUserDetailsResponse" },
                "example": {
                  "github_username": "echobt",
                  "hotkey": "5FHneW46...",
                  "registered_at": "2026-01-15T10:00:00Z",
                  "total_issues": 10,
                  "valid_issues": 5,
                  "invalid_issues": 1,
                  "open_issues": 4,
                  "recent_issues": []
                }
              }
            }
          },
          "404": {
            "description": "User not found",
            "content": {
              "application/json": {
                "example": { "error": "GitHub user not found" }
              }
            }
          }
        }
      }
    },
    "/sync/status": {
      "get": {
        "summary": "Get sync status",
        "description": "Get GitHub sync status for all repos",
        "tags": ["Sync"],
        "responses": {
          "200": {
            "description": "Sync status",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/SyncStatusResponse" },
                "example": {
                  "repos": [
                    {
                      "repo_owner": "PlatformNetwork",
                      "repo_name": "bounty-challenge",
                      "last_sync_at": "2026-01-19T00:47:26Z",
                      "last_issue_updated_at": "2026-01-19T00:47:00Z",
                      "issues_synced": 1
                    }
                  ],
                  "issues_stats": {
                    "total": 1,
                    "open": 1,
                    "closed": 0,
                    "valid": 1,
                    "invalid": 0,
                    "pending": 0
                  }
                }
              }
            }
          }
        }
      }
    },
    "/sync/trigger": {
      "post": {
        "summary": "Trigger manual sync",
        "description": "Manually trigger GitHub issues sync for all repos",
        "tags": ["Sync"],
        "responses": {
          "200": {
            "description": "Sync result",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/SyncTriggerResponse" },
                "example": {
                  "success": true,
                  "issues_synced": 5,
                  "errors": []
                }
              }
            }
          }
        }
      }
    },
    "/evaluate": {
      "post": {
        "summary": "Evaluate submission",
        "description": "Platform SDK evaluation endpoint (internal)",
        "tags": ["Platform SDK"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/EvaluationRequest" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Evaluation result",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/EvaluationResponse" }
              }
            }
          }
        }
      }
    },
    "/validate": {
      "post": {
        "summary": "Validate submission",
        "description": "Platform SDK validation endpoint (internal)",
        "tags": ["Platform SDK"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/ValidationRequest" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Validation result",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ValidationResponse" }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "HealthResponse": {
        "type": "object",
        "properties": {
          "healthy": { "type": "boolean" },
          "load": { "type": "number" },
          "pending": { "type": "integer" },
          "uptime_secs": { "type": "integer" },
          "version": { "type": "string" },
          "challenge_id": { "type": "string" }
        }
      },
      "ConfigResponse": {
        "type": "object",
        "description": "Challenge configuration (dynamic)"
      },
      "GetWeightsResponse": {
        "type": "object",
        "properties": {
          "weights": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/MinerWeight" }
          },
          "epoch": { "type": "integer" },
          "challenge_id": { "type": "string" },
          "total_miners": { "type": "integer" }
        }
      },
      "MinerWeight": {
        "type": "object",
        "properties": {
          "hotkey": { "type": "string" },
          "weight": { "type": "number" }
        }
      },
      "LeaderboardResponse": {
        "type": "object",
        "properties": {
          "leaderboard": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/LeaderboardEntry" }
          }
        }
      },
      "LeaderboardEntry": {
        "type": "object",
        "properties": {
          "github_username": { "type": "string" },
          "hotkey": { "type": "string" },
          "issues_resolved_24h": { "type": "integer" },
          "weight": { "type": "number" }
        }
      },
      "RegisterRequest": {
        "type": "object",
        "required": ["hotkey", "github_username", "signature", "timestamp"],
        "properties": {
          "hotkey": { "type": "string", "description": "SS58 encoded hotkey" },
          "github_username": { "type": "string" },
          "signature": { "type": "string", "description": "Hex-encoded sr25519 signature" },
          "timestamp": { "type": "integer", "description": "Unix timestamp (must be within 5 min)" }
        }
      },
      "RegisterResponse": {
        "type": "object",
        "properties": {
          "success": { "type": "boolean" },
          "message": { "type": "string", "nullable": true },
          "error": { "type": "string", "nullable": true }
        }
      },
      "StatusResponse": {
        "type": "object",
        "properties": {
          "registered": { "type": "boolean" },
          "github_username": { "type": "string", "nullable": true },
          "valid_issues_count": { "type": "integer", "nullable": true },
          "invalid_issues_count": { "type": "integer", "nullable": true },
          "balance": { "type": "integer", "nullable": true, "description": "valid - invalid" },
          "is_penalized": { "type": "boolean" },
          "weight": { "type": "number", "nullable": true }
        }
      },
      "StatsResponse": {
        "type": "object",
        "properties": {
          "total_bounties": { "type": "integer" },
          "total_miners": { "type": "integer" },
          "total_invalid": { "type": "integer" },
          "penalized_miners": { "type": "integer" },
          "challenge_id": { "type": "string" },
          "version": { "type": "string" }
        }
      },
      "InvalidIssueRequest": {
        "type": "object",
        "required": ["issue_id", "repo_owner", "repo_name", "github_username", "issue_url"],
        "properties": {
          "issue_id": { "type": "integer" },
          "repo_owner": { "type": "string" },
          "repo_name": { "type": "string" },
          "github_username": { "type": "string" },
          "issue_url": { "type": "string" },
          "issue_title": { "type": "string", "nullable": true },
          "reason": { "type": "string", "nullable": true }
        }
      },
      "InvalidIssueResponse": {
        "type": "object",
        "properties": {
          "success": { "type": "boolean" },
          "message": { "type": "string", "nullable": true },
          "error": { "type": "string", "nullable": true }
        }
      },
      "CachedIssue": {
        "type": "object",
        "properties": {
          "issue_id": { "type": "integer" },
          "repo_owner": { "type": "string" },
          "repo_name": { "type": "string" },
          "github_username": { "type": "string" },
          "title": { "type": "string" },
          "state": { "type": "string", "enum": ["open", "closed"] },
          "labels": { "type": "array", "items": { "type": "string" } },
          "created_at": { "type": "string", "format": "date-time" },
          "updated_at": { "type": "string", "format": "date-time" },
          "closed_at": { "type": "string", "format": "date-time", "nullable": true },
          "issue_url": { "type": "string" }
        }
      },
      "IssuesListResponse": {
        "type": "object",
        "properties": {
          "issues": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/CachedIssue" }
          },
          "count": { "type": "integer" },
          "limit": { "type": "integer" },
          "offset": { "type": "integer" }
        }
      },
      "IssuesStatsResponse": {
        "type": "object",
        "properties": {
          "total": { "type": "integer" },
          "open": { "type": "integer" },
          "closed": { "type": "integer" },
          "valid": { "type": "integer", "description": "Issues with 'valid' label" },
          "invalid": { "type": "integer", "description": "Issues with 'invalid' label" },
          "pending": { "type": "integer", "description": "Closed without valid/invalid" }
        }
      },
      "HotkeyDetailsResponse": {
        "type": "object",
        "properties": {
          "hotkey": { "type": "string" },
          "github_username": { "type": "string" },
          "registered_at": { "type": "string", "format": "date-time" },
          "valid_issues": { "type": "integer" },
          "invalid_issues": { "type": "integer" },
          "balance": { "type": "integer" },
          "is_penalized": { "type": "boolean" },
          "weight": { "type": "number" },
          "recent_issues": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/CachedIssueShort" }
          }
        }
      },
      "CachedIssueShort": {
        "type": "object",
        "properties": {
          "issue_id": { "type": "integer" },
          "repo_owner": { "type": "string" },
          "repo_name": { "type": "string" },
          "title": { "type": "string" },
          "state": { "type": "string" },
          "labels": { "type": "array", "items": { "type": "string" } },
          "updated_at": { "type": "string", "format": "date-time" },
          "issue_url": { "type": "string" }
        }
      },
      "GitHubUserDetailsResponse": {
        "type": "object",
        "properties": {
          "github_username": { "type": "string" },
          "hotkey": { "type": "string", "nullable": true },
          "registered_at": { "type": "string", "format": "date-time", "nullable": true },
          "total_issues": { "type": "integer" },
          "valid_issues": { "type": "integer" },
          "invalid_issues": { "type": "integer" },
          "open_issues": { "type": "integer" },
          "recent_issues": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/CachedIssueShort" }
          }
        }
      },
      "SyncStatusResponse": {
        "type": "object",
        "properties": {
          "repos": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/RepoSyncStatus" }
          },
          "issues_stats": { "$ref": "#/components/schemas/IssuesStatsResponse" }
        }
      },
      "RepoSyncStatus": {
        "type": "object",
        "properties": {
          "repo_owner": { "type": "string" },
          "repo_name": { "type": "string" },
          "last_sync_at": { "type": "string", "format": "date-time" },
          "last_issue_updated_at": { "type": "string", "format": "date-time", "nullable": true },
          "issues_synced": { "type": "integer" }
        }
      },
      "SyncTriggerResponse": {
        "type": "object",
        "properties": {
          "success": { "type": "boolean" },
          "issues_synced": { "type": "integer" },
          "errors": { "type": "array", "items": { "type": "string" } }
        }
      },
      "EvaluationRequest": {
        "type": "object",
        "description": "Platform SDK evaluation request"
      },
      "EvaluationResponse": {
        "type": "object",
        "description": "Platform SDK evaluation response"
      },
      "ValidationRequest": {
        "type": "object",
        "description": "Platform SDK validation request"
      },
      "ValidationResponse": {
        "type": "object",
        "properties": {
          "valid": { "type": "boolean" },
          "errors": { "type": "array", "items": { "type": "string" } },
          "warnings": { "type": "array", "items": { "type": "string" } }
        }
      }
    }
  },
  "tags": [
    { "name": "System", "description": "Health and configuration" },
    { "name": "Weights", "description": "Miner weights and leaderboard" },
    { "name": "Registration", "description": "GitHub account registration" },
    { "name": "Stats", "description": "Challenge statistics" },
    { "name": "Issues", "description": "GitHub issues management" },
    { "name": "Details", "description": "Detailed info for hotkeys and users" },
    { "name": "Sync", "description": "GitHub sync management" },
    { "name": "Platform SDK", "description": "Internal platform endpoints" }
  ]
}
